<html ng-app="custom-webapp-ui" lang="en" style="background-color: white">
  <head>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <script>
      angular.module("custom-webapp-ui", []).controller('CustomUIController', function CustomUIController($scope) {
        $scope.foods = [
          { name: "fruits", value: 5 },
          { name: "vegetables", value: 5 },
          { name: "meat", value: 5 },
          { name: "dairy", value: 5 }
        ];

        // Call ready when the app is initialized
        window.Telegram.WebApp.ready();

        // Initialize and set up MainButton
        const mainButton = window.Telegram.WebApp.MainButton;
        mainButton.text = "Save Preferences";
        mainButton.enable();
        mainButton.show();
        mainButton.onClick(function(){
          window.Telegram.WebApp.sendData(JSON.stringify($scope.foods));
        });

        // Function to reset values
        $scope.resetValues = function() {
            window.Telegram.WebApp.showPopup({
                title: "Reset Confirmation",
                message: "Are you sure you want to reset all food preferences to 5?",
                buttons: [
                    {id: 'yes', type: 'destructive', text: 'Yes, Reset'},
                    {id: 'no', type: 'cancel', text: 'No'}
                ]
            }, function(buttonId) {
                if (buttonId === 'yes') {
                    $scope.$apply(function() { // Use $apply to update Angular scope after async callback
                        $scope.foods.forEach(food => food.value = 5);
                        window.Telegram.WebApp.HapticFeedback.notificationOccurred('success'); // Optional haptic feedback
                    });
                } else {
                    window.Telegram.WebApp.HapticFeedback.notificationOccurred('error'); // Optional haptic feedback
                }
            });
        };

        // Example of using BackButton (if you had multiple "pages")
        const backButton = window.Telegram.WebApp.BackButton;
        // For this simple app, we'll just hide/show it as an example
        // In a real multi-page app, you'd show it on subsequent pages.
        backButton.hide(); // Start hidden
        // backButton.onClick(function() { /* your navigation logic */ });

        // Example: Get theme parameters
        console.log("Theme Parameters:", window.Telegram.WebApp.themeParams);
        // You could use these to dynamically set styles in your app.

        // Example: Enable closing confirmation if unsaved changes exist
        // This is a simplified example; in a real app, you'd check for actual changes.
        // let hasUnsavedChanges = false;
        // window.Telegram.WebApp.onEvent('viewportChanged', function() {
        //     if (hasUnsavedChanges) {
        //         window.Telegram.WebApp.enableClosingConfirmation();
        //     } else {
        //         window.Telegram.WebApp.disableClosingConfirmation();
        //     }
        // });
      });
    </script>
    <style>
      /* Optional: Use Telegram theme variables for a more integrated look */
      body {
        background-color: var(--tg-theme-bg-color);
        color: var(--tg-theme-text-color);
      }
      button {
        background-color: var(--tg-theme-button-color);
        color: var(--tg-theme-button-text-color);
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
      }
    </style>
  </head>
  <body ng-controller="CustomUIController">
    <div ng-repeat="food in foods">
      <div style="width: 100px; display: inline-block">{{food.name}} : {{food.value}}</div>
      <input style="display: inline-block" type="range" min="1" max="10" ng-model="food.value" value="{{food.value}}">
    </div>

    <button ng-click="resetValues()" style="margin-top: 20px;">
      Reset Preferences
    </button>
  </body>
</html>